--cleaner solution using state monads
